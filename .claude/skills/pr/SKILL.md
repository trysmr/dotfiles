---
name: pr
description: プロジェクトのブランチ戦略（staging/mainへのPR）に従ってプルリクエストを作成。コミット済みの変更をレビュー依頼する際に使用
allowed-tools: Read, Bash
---

# Pull Request Creation Workflow

このスキルはコミット済みの変更に対してプルリクエストを作成します。

**前提条件**: 変更が既にコミット・プッシュされていること

## 実行手順

### 1. ブランチ戦略の確認

まず`README.md`を読み込んで、プロジェクトのブランチ戦略を理解してください：

```bash
Read README.md
```

**ベースブランチの確認**：
```bash
git branch -a
```

で利用可能なブランチを確認し、以下のルールに従います：

**ベースブランチ選択ルール**：
- `hotfix/*` → `main`をベースにする
- **その他すべて** → `staging`が存在する場合は`staging`、存在しない場合は`main`をベースにする

### 2. 変更内容の確認

```bash
git status
git log --oneline -5
git diff origin/main...HEAD  # または origin/staging...HEAD
```

でコミット履歴と変更内容を確認します。

### 3. PR情報の準備

以下の情報をユーザーに提示し、PR作成の許可を得てください：

- **ベースブランチ**: `staging`または`main`
- **PRタイトル**: 変更内容を簡潔に表現
- **PR本文**: 以下のテンプレートに従って作成

**PR本文テンプレート**：

```markdown
## 概要
[変更の目的と背景を記述]

## 変更点
- [具体的な変更内容1]
- [具体的な変更内容2]
- [具体的な変更内容3]

## テスト計画
- [x] [実施済みのテスト]
- [ ] [実施予定のテスト（レビュー時に確認）]
```

### 4. ユーザー確認

PR情報をユーザーに提示し、「はい」「OK」「作成して」などの許可を得てください。

**重要**: ユーザーの許可なしにPRを作成しないでください。

### 5. PR作成

ユーザーの許可を得てから、以下のコマンドでPRを作成します：

```bash
# hotfix/* ブランチの場合のみ
gh pr create --base main --title "タイトル" --body "$(cat <<'EOF'
## 概要
...

## 変更点
...

## テスト計画
...
EOF
)"

# その他すべて（feature/*, bugfix/*, refactor/*, chore/*, test/*, docs/*）
# stagingが存在する場合
gh pr create --base staging --title "タイトル" --body "$(cat <<'EOF'
...
EOF
)"

# stagingが存在しない場合
gh pr create --base main --title "タイトル" --body "$(cat <<'EOF'
...
EOF
)"
```

### 6. PR URLの確認

PR作成後、URLをユーザーに提示します。

## チェックリスト

実行前に確認すべき項目：

- [ ] README.mdを読み込んでブランチ戦略を理解した
- [ ] `git branch -a`で利用可能なブランチを確認した
- [ ] 変更が既にコミット・プッシュされている
- [ ] ベースブランチを正しく選択した（`staging`が存在する場合は`staging`、存在しない場合やhotfixの場合は`main`）
- [ ] PR情報をユーザーに提示し、許可を得た
- [ ] PR本文に「概要」「変更点」「テスト計画」を含めた

## よくある間違い

❌ **間違い**: ユーザーの許可なしにPRを作成
✅ **正解**: 必ずPR情報を提示してユーザーの許可を得る

❌ **間違い**: `git branch -a`でブランチを確認せずに決め打ちでベースブランチを指定
✅ **正解**: 必ず`git branch -a`で利用可能なブランチを確認してから指定

❌ **間違い**: PR作成時にベースブランチを指定しない（デフォルトはmainになる）
✅ **正解**: 必ず`--base staging`または`--base main`を明示的に指定

❌ **間違い**: `staging`が存在しないプロジェクトで`--base staging`を指定
✅ **正解**: `git branch -a`で確認し、存在しない場合は`--base main`を指定

## 使用例

### 例1: 新機能追加の場合（stagingあり）

**ステップ1**: ブランチ確認
```bash
git branch -a
# staging が存在することを確認
```

**ステップ2**: PR情報をユーザーに提示
```
以下の内容でPRを作成してよろしいですか？

ベースブランチ: staging
タイトル: ユーザー検索機能を追加

本文:
## 概要
ユーザー一覧画面に検索機能を追加しました。

## 変更点
- 名前・メールアドレスでの検索に対応
- ページネーション実装
- 検索条件の保持機能追加

## テスト計画
- [x] 単体テスト実施
- [x] 検索機能の動作確認
- [ ] レビュー後に結合テスト実施
```

**ステップ3**: ユーザーの許可を待つ

**ステップ4**: 許可後にPR作成
```bash
gh pr create --base staging --title "ユーザー検索機能を追加" --body "$(cat <<'EOF'
## 概要
ユーザー一覧画面に検索機能を追加しました。

## 変更点
- 名前・メールアドレスでの検索に対応
- ページネーション実装
- 検索条件の保持機能追加

## テスト計画
- [x] 単体テスト実施
- [x] 検索機能の動作確認
- [ ] レビュー後に結合テスト実施
EOF
)"
```

### 例2: ドキュメント更新の場合（stagingなし）

**ステップ1**: ブランチ確認
```bash
git branch -a
# staging が存在しないことを確認
```

**ステップ2**: PR情報をユーザーに提示
```
以下の内容でPRを作成してよろしいですか？

ベースブランチ: main
タイトル: 申込書発行仕様書にビジネスフロー図を追加

本文:
## 概要
申込書発行仕様書にビジネスフロー概要セクションを追加し、
セールス担当者の操作からPDF生成までの全体像をsequenceDiagramで可視化しました。

## 変更点
- 新規セクション「1.2 ビジネスフロー概要」を追加
- sequenceDiagramでビジネスフローを可視化
- 既存セクションの番号を調整

## テスト計画
- [x] Mermaid図の構文確認
- [x] 目次リンクの動作確認
- [x] 仕様書全体の構成確認
```

**ステップ3**: ユーザーの許可を待つ

**ステップ4**: 許可後にPR作成
```bash
gh pr create --base main --title "申込書発行仕様書にビジネスフロー図を追加" --body "$(cat <<'EOF'
## 概要
申込書発行仕様書にビジネスフロー概要セクションを追加し、
セールス担当者の操作からPDF生成までの全体像をsequenceDiagramで可視化しました。

## 変更点
- 新規セクション「1.2 ビジネスフロー概要」を追加
- sequenceDiagramでビジネスフローを可視化
- 既存セクションの番号を調整

## テスト計画
- [x] Mermaid図の構文確認
- [x] 目次リンクの動作確認
- [x] 仕様書全体の構成確認
EOF
)"
```

## PRのマージ（ユーザーから指示があった場合）

```bash
gh pr merge <PR番号> --merge --delete-branch
```

**注意**: プロジェクトでは**Merge commit**を使用します（Squash mergeは使用しない）。
